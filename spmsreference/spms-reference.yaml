apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: '254'
    field.cattle.io/publicEndpoints: >-
      [{"addresses":["20.227.21.214"],"port":80,"protocol":"HTTP","serviceName":"spms:spms-clusterip-test","ingressName":"spms:spms-ingress-test","hostname":"scienceprojects-test.dbca.wa.gov.au","path":"/","allNodes":false},{"addresses":["20.227.21.214"],"port":80,"protocol":"HTTP","serviceName":"spms:spms-clusterip-test","ingressName":"spms:spms-ingress-test","hostname":"scienceprojects-test.dbca.wa.gov.au","path":"/admin","allNodes":false},{"addresses":["20.227.21.214"],"port":80,"protocol":"HTTP","serviceName":"spms:spms-clusterip-test","ingressName":"spms:spms-ingress-test","hostname":"scienceprojects-test.dbca.wa.gov.au","path":"/api","allNodes":false},{"addresses":["20.227.21.214"],"port":80,"protocol":"HTTP","serviceName":"spms:spms-clusterip-test","ingressName":"spms:spms-ingress-test","hostname":"scienceprojects-test.dbca.wa.gov.au","path":"/files","allNodes":false},{"addresses":["20.227.21.214"],"port":80,"protocol":"HTTP","serviceName":"spms:spms-clusterip-test","ingressName":"spms:spms-ingress-test","hostname":"scienceprojects-test.dbca.wa.gov.au","path":"/static","allNodes":false},{"addresses":["20.227.21.214"],"port":80,"protocol":"HTTP","serviceName":"spms:spms-clusterip-test","ingressName":"spms:spms-ingress-test","hostname":"science-profiles-test.dbca.wa.gov.au","path":"/","allNodes":false}]
    kubectl.kubernetes.io/last-applied-configuration: >
      {"apiVersion":"apps/v1","kind":"Deployment","metadata":{"annotations":{},"labels":{"app":"spms-test","variant":"test"},"name":"spms-deployment-test","namespace":"spms"},"spec":{"selector":{"matchLabels":{"app":"spms-test","variant":"test"}},"strategy":{"type":"RollingUpdate"},"template":{"metadata":{"labels":{"app":"spms-test","variant":"test"}},"spec":{"automountServiceAccountToken":false,"containers":[{"env":[{"name":"DATABASE_URL","valueFrom":{"secretKeyRef":{"key":"DATABASE_URL","name":"spms-env-test"}}},{"name":"DEFAULT_FROM_EMAIL","valueFrom":{"secretKeyRef":{"key":"DEFAULT_FROM_EMAIL","name":"spms-env-test"}}},{"name":"ENVIRONMENT","valueFrom":{"secretKeyRef":{"key":"ENVIRONMENT","name":"spms-env-test"}}},{"name":"EXTERNAL_PASS","valueFrom":{"secretKeyRef":{"key":"EXTERNAL_PASS","name":"spms-env-test"}}},{"name":"IT_ASSETS_ACCESS_TOKEN","valueFrom":{"secretKeyRef":{"key":"IT_ASSETS_ACCESS_TOKEN","name":"spms-env-test"}}},{"name":"IT_ASSETS_USER","valueFrom":{"secretKeyRef":{"key":"IT_ASSETS_USER","name":"spms-env-test"}}},{"name":"LIBRARY_API_URL","valueFrom":{"secretKeyRef":{"key":"LIBRARY_API_URL","name":"spms-env-test"}}},{"name":"LIBRARY_BEARER_TOKEN","valueFrom":{"secretKeyRef":{"key":"LIBRARY_BEARER_TOKEN","name":"spms-env-test"}}},{"name":"PRINCE_SERVER_URL","valueFrom":{"secretKeyRef":{"key":"PRINCE_SERVER_URL","name":"spms-env-test"}}},{"name":"SECRET_KEY","valueFrom":{"secretKeyRef":{"key":"SECRET_KEY","name":"spms-env-test"}}},{"name":"SENTRY_URL","valueFrom":{"secretKeyRef":{"key":"SENTRY_URL","name":"spms-env-test"}}},{"name":"SPMS_MAINTAINER_EMAIL","valueFrom":{"secretKeyRef":{"key":"SPMS_MAINTAINER_EMAIL","name":"spms-env-test"}}},{"name":"TZ","value":"Australia/Perth"}],"image":"ghcr.io/dbca-wa/science-projects-service","imagePullPolicy":"Always","name":"spms-backend","resources":{"limits":{"cpu":"1000m","memory":"2Gi"},"requests":{"cpu":"5m","memory":"200Mi"}},"securityContext":{"allowPrivilegeEscalation":false,"capabilities":{"drop":["ALL"]},"privileged":false,"readOnlyRootFilesystem":true,"runAsNonRoot":true},"volumeMounts":[{"mountPath":"/usr/src/app/backend/files","name":"spms-media-test"},{"mountPath":"/usr/lib/prince/license","name":"prince2-license-test","readOnly":true},{"mountPath":"/tmp","name":"tmpfs-ram-backend"}]},{"env":[{"name":"TZ","value":"Australia/Perth"}],"image":"ghcr.io/dbca-wa/science-projects-client","imagePullPolicy":"Always","name":"spms-frontend","resources":{"limits":{"cpu":"1000m","memory":"1Gi"},"requests":{"cpu":"5m","memory":"64Mi"}},"securityContext":{"allowPrivilegeEscalation":false,"capabilities":{"drop":["ALL"]},"privileged":false,"readOnlyRootFilesystem":true,"runAsNonRoot":false,"runAsUser":1000},"volumeMounts":[{"mountPath":"/tmp","name":"tmpfs-ram-frontend"}]}],"initContainers":[{"command":["/bin/chown","-R","10001:10001","/usr/src/app/backend/files"],"image":"busybox","name":"chown-files","volumeMounts":[{"mountPath":"/usr/src/app/backend/files","name":"spms-media-test"}]}],"restartPolicy":"Always","terminationGracePeriodSeconds":180,"volumes":[{"name":"spms-media-test","persistentVolumeClaim":{"claimName":"spms-media-data-test"}},{"configMap":{"defaultMode":420,"name":"prince2-license-test"},"name":"prince2-license-test"},{"emptyDir":{"medium":"Memory"},"name":"tmpfs-ram-backend"},{"emptyDir":{"medium":"Memory"},"name":"tmpfs-ram-frontend"}]}}}}
  creationTimestamp: '2024-08-11T23:18:47Z'
  generation: 753
  labels:
    app: spms-test
    variant: test
  managedFields:
    - apiVersion: apps/v1
      fieldsType: FieldsV1
      fieldsV1:
        f:spec:
          f:replicas: {}
      manager: kube-controller-manager
      operation: Update
      subresource: scale
    - apiVersion: apps/v1
      fieldsType: FieldsV1
      fieldsV1:
        f:metadata:
          f:annotations:
            .: {}
            f:kubectl.kubernetes.io/last-applied-configuration: {}
          f:labels:
            .: {}
            f:app: {}
            f:variant: {}
        f:spec:
          f:progressDeadlineSeconds: {}
          f:revisionHistoryLimit: {}
          f:selector: {}
          f:strategy:
            f:rollingUpdate:
              .: {}
              f:maxSurge: {}
              f:maxUnavailable: {}
            f:type: {}
          f:template:
            f:metadata:
              f:labels:
                .: {}
                f:app: {}
                f:variant: {}
            f:spec:
              f:automountServiceAccountToken: {}
              f:containers:
                k:{"name":"spms-backend"}:
                  .: {}
                  f:env:
                    .: {}
                    k:{"name":"DATABASE_URL"}:
                      .: {}
                      f:name: {}
                      f:valueFrom: {}
                    k:{"name":"DEFAULT_FROM_EMAIL"}:
                      .: {}
                      f:name: {}
                      f:valueFrom: {}
                    k:{"name":"EXTERNAL_PASS"}:
                      .: {}
                      f:name: {}
                      f:valueFrom: {}
                    k:{"name":"IT_ASSETS_ACCESS_TOKEN"}:
                      .: {}
                      f:name: {}
                      f:valueFrom: {}
                    k:{"name":"IT_ASSETS_USER"}:
                      .: {}
                      f:name: {}
                      f:valueFrom: {}
                    k:{"name":"PRINCE_SERVER_URL"}:
                      .: {}
                      f:name: {}
                      f:valueFrom: {}
                    k:{"name":"SECRET_KEY"}:
                      .: {}
                      f:name: {}
                      f:valueFrom: {}
                    k:{"name":"SENTRY_URL"}:
                      .: {}
                      f:name: {}
                      f:valueFrom: {}
                    k:{"name":"SPMS_MAINTAINER_EMAIL"}:
                      .: {}
                      f:name: {}
                      f:valueFrom: {}
                    k:{"name":"TZ"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                  f:imagePullPolicy: {}
                  f:name: {}
                  f:resources:
                    .: {}
                    f:limits:
                      .: {}
                      f:cpu: {}
                      f:memory: {}
                    f:requests:
                      .: {}
                      f:cpu: {}
                      f:memory: {}
                  f:securityContext:
                    .: {}
                    f:allowPrivilegeEscalation: {}
                    f:capabilities:
                      .: {}
                      f:drop: {}
                    f:privileged: {}
                    f:readOnlyRootFilesystem: {}
                    f:runAsNonRoot: {}
                  f:terminationMessagePath: {}
                  f:terminationMessagePolicy: {}
                  f:volumeMounts:
                    .: {}
                    k:{"mountPath":"/tmp"}:
                      .: {}
                      f:mountPath: {}
                      f:name: {}
                    k:{"mountPath":"/usr/lib/prince/license"}:
                      f:name: {}
                    k:{"mountPath":"/usr/src/app/backend/files"}:
                      .: {}
                      f:mountPath: {}
                      f:name: {}
                k:{"name":"spms-frontend"}:
                  .: {}
                  f:env:
                    .: {}
                    k:{"name":"TZ"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                  f:imagePullPolicy: {}
                  f:name: {}
                  f:resources:
                    .: {}
                    f:limits:
                      .: {}
                      f:cpu: {}
                      f:memory: {}
                    f:requests:
                      .: {}
                      f:cpu: {}
                      f:memory: {}
                  f:securityContext:
                    .: {}
                    f:allowPrivilegeEscalation: {}
                    f:capabilities:
                      .: {}
                      f:drop: {}
                    f:privileged: {}
                    f:readOnlyRootFilesystem: {}
                  f:terminationMessagePath: {}
                  f:terminationMessagePolicy: {}
                  f:volumeMounts:
                    .: {}
                    k:{"mountPath":"/tmp"}:
                      .: {}
                      f:mountPath: {}
                      f:name: {}
              f:dnsPolicy: {}
              f:initContainers:
                .: {}
                k:{"name":"chown-files"}:
                  .: {}
                  f:command: {}
                  f:image: {}
                  f:imagePullPolicy: {}
                  f:name: {}
                  f:resources: {}
                  f:terminationMessagePath: {}
                  f:terminationMessagePolicy: {}
                  f:volumeMounts:
                    .: {}
                    k:{"mountPath":"/usr/src/app/backend/files"}:
                      .: {}
                      f:mountPath: {}
                      f:name: {}
              f:restartPolicy: {}
              f:schedulerName: {}
              f:securityContext: {}
              f:terminationGracePeriodSeconds: {}
              f:volumes:
                .: {}
                k:{"name":"prince2-license-test"}:
                  .: {}
                  f:configMap:
                    .: {}
                    f:defaultMode: {}
                    f:name: {}
                  f:name: {}
                k:{"name":"spms-media-test"}:
                  .: {}
                  f:name: {}
                  f:persistentVolumeClaim:
                    .: {}
                    f:claimName: {}
                k:{"name":"tmpfs-ram-backend"}:
                  .: {}
                  f:emptyDir:
                    .: {}
                    f:medium: {}
                  f:name: {}
                k:{"name":"tmpfs-ram-frontend"}:
                  .: {}
                  f:emptyDir:
                    .: {}
                    f:medium: {}
                  f:name: {}
      manager: kubectl-client-side-apply
      operation: Update
      time: '2025-09-12T01:18:47Z'
    - apiVersion: apps/v1
      fieldsType: FieldsV1
      fieldsV1:
        f:metadata:
          f:annotations:
            f:field.cattle.io/publicEndpoints: {}
        f:spec:
          f:template:
            f:metadata:
              f:annotations:
                .: {}
                f:cattle.io/timestamp: {}
              f:namespace: {}
            f:spec:
              f:containers:
                k:{"name":"spms-backend"}:
                  f:env:
                    k:{"name":"DATABASE_URL"}:
                      f:valueFrom:
                        f:secretKeyRef: {}
                    k:{"name":"DEFAULT_FROM_EMAIL"}:
                      f:valueFrom:
                        f:secretKeyRef: {}
                    k:{"name":"ENVIRONMENT"}:
                      .: {}
                      f:name: {}
                      f:valueFrom:
                        .: {}
                        f:secretKeyRef: {}
                    k:{"name":"EXTERNAL_PASS"}:
                      f:valueFrom:
                        f:secretKeyRef: {}
                    k:{"name":"IT_ASSETS_ACCESS_TOKEN"}:
                      f:valueFrom:
                        f:secretKeyRef: {}
                    k:{"name":"IT_ASSETS_USER"}:
                      f:valueFrom:
                        f:secretKeyRef: {}
                    k:{"name":"LIBRARY_API_URL"}:
                      .: {}
                      f:name: {}
                      f:valueFrom:
                        .: {}
                        f:secretKeyRef: {}
                    k:{"name":"LIBRARY_BEARER_TOKEN"}:
                      .: {}
                      f:name: {}
                      f:valueFrom:
                        .: {}
                        f:secretKeyRef: {}
                    k:{"name":"PRINCE_SERVER_URL"}:
                      f:valueFrom:
                        f:secretKeyRef: {}
                    k:{"name":"SECRET_KEY"}:
                      f:valueFrom:
                        f:secretKeyRef: {}
                    k:{"name":"SENTRY_URL"}:
                      f:valueFrom:
                        f:secretKeyRef: {}
                    k:{"name":"SPMS_MAINTAINER_EMAIL"}:
                      f:valueFrom:
                        f:secretKeyRef: {}
                  f:image: {}
                  f:volumeMounts:
                    k:{"mountPath":"/usr/lib/prince/license"}:
                      .: {}
                      f:mountPath: {}
                      f:readOnly: {}
                k:{"name":"spms-frontend"}:
                  f:image: {}
                  f:securityContext:
                    f:runAsNonRoot: {}
                    f:runAsUser: {}
              f:tolerations: {}
              f:volumes:
                k:{"name":"prince2-license"}:
                  .: {}
                  f:configMap:
                    .: {}
                    f:defaultMode: {}
                    f:name: {}
                  f:name: {}
      manager: agent
      operation: Update
      time: '2025-11-05T02:13:02Z'
    - apiVersion: apps/v1
      fieldsType: FieldsV1
      fieldsV1:
        f:metadata:
          f:annotations:
            f:deployment.kubernetes.io/revision: {}
        f:status:
          f:availableReplicas: {}
          f:conditions:
            .: {}
            k:{"type":"Available"}:
              .: {}
              f:lastTransitionTime: {}
              f:lastUpdateTime: {}
              f:message: {}
              f:reason: {}
              f:status: {}
              f:type: {}
            k:{"type":"Progressing"}:
              .: {}
              f:lastTransitionTime: {}
              f:lastUpdateTime: {}
              f:message: {}
              f:reason: {}
              f:status: {}
              f:type: {}
          f:observedGeneration: {}
          f:readyReplicas: {}
          f:replicas: {}
          f:updatedReplicas: {}
      manager: kube-controller-manager
      operation: Update
      subresource: status
      time: '2025-11-06T22:37:32Z'
  name: spms-deployment-test
  namespace: spms
  resourceVersion: '483241230'
  uid: 2b6ef5fc-8190-40e6-bec2-c6c299ea930d
spec:
  progressDeadlineSeconds: 600
  replicas: 2
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: spms-test
      variant: test
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      annotations:
        cattle.io/timestamp: '2025-10-02T04:19:47Z'
      creationTimestamp: null
      labels:
        app: spms-test
        variant: test
      namespace: spms
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: DATABASE_URL
              valueFrom:
                secretKeyRef:
                  key: DATABASE_URL
                  name: spms-env-test-59b68k7k5k
                  optional: false
            - name: DEFAULT_FROM_EMAIL
              valueFrom:
                secretKeyRef:
                  key: DEFAULT_FROM_EMAIL
                  name: spms-env-test-59b68k7k5k
                  optional: false
            - name: ENVIRONMENT
              valueFrom:
                secretKeyRef:
                  key: ENVIRONMENT
                  name: spms-env-test-59b68k7k5k
                  optional: false
            - name: EXTERNAL_PASS
              valueFrom:
                secretKeyRef:
                  key: EXTERNAL_PASS
                  name: spms-env-test-59b68k7k5k
                  optional: false
            - name: IT_ASSETS_ACCESS_TOKEN
              valueFrom:
                secretKeyRef:
                  key: IT_ASSETS_ACCESS_TOKEN
                  name: spms-env-test-59b68k7k5k
                  optional: false
            - name: IT_ASSETS_USER
              valueFrom:
                secretKeyRef:
                  key: IT_ASSETS_USER
                  name: spms-env-test-59b68k7k5k
                  optional: false
            - name: LIBRARY_API_URL
              valueFrom:
                secretKeyRef:
                  key: LIBRARY_API_URL
                  name: spms-env-test-59b68k7k5k
                  optional: false
            - name: LIBRARY_BEARER_TOKEN
              valueFrom:
                secretKeyRef:
                  key: LIBRARY_BEARER_TOKEN
                  name: spms-env-test-59b68k7k5k
                  optional: false
            - name: PRINCE_SERVER_URL
              valueFrom:
                secretKeyRef:
                  key: PRINCE_SERVER_URL
                  name: spms-env-test-59b68k7k5k
                  optional: false
            - name: SECRET_KEY
              valueFrom:
                secretKeyRef:
                  key: SECRET_KEY
                  name: spms-env-test-59b68k7k5k
                  optional: false
            - name: SENTRY_URL
              valueFrom:
                secretKeyRef:
                  key: SENTRY_URL
                  name: spms-env-test-59b68k7k5k
                  optional: false
            - name: SPMS_MAINTAINER_EMAIL
              valueFrom:
                secretKeyRef:
                  key: SPMS_MAINTAINER_EMAIL
                  name: spms-env-test-59b68k7k5k
                  optional: false
            - name: TZ
              value: Australia/Perth
          image: ghcr.io/dbca-wa/science-projects-service
          imagePullPolicy: Always
          name: spms-backend
          resources:
            limits:
              cpu: '1'
              memory: 2Gi
            requests:
              cpu: 5m
              memory: 200Mi
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                - ALL
            privileged: false
            readOnlyRootFilesystem: true
            runAsNonRoot: true
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
            - mountPath: /usr/src/app/backend/files
              name: spms-media-test
            - mountPath: /usr/lib/prince/license
              name: prince2-license-test
              readOnly: true
            - mountPath: /tmp
              name: tmpfs-ram-backend
        - env:
            - name: TZ
              value: Australia/Perth
          image: ghcr.io/dbca-wa/science-projects-client:test
          imagePullPolicy: Always
          name: spms-frontend
          resources:
            limits:
              cpu: '1'
              memory: 1Gi
            requests:
              cpu: 5m
              memory: 64Mi
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                - ALL
            privileged: false
            readOnlyRootFilesystem: true
            runAsNonRoot: true
            runAsUser: 1000
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
            - mountPath: /tmp
              name: tmpfs-ram-frontend
      dnsPolicy: ClusterFirst
      initContainers:
        - command:
            - /bin/chown
            - '-R'
            - '10001:10001'
            - /usr/src/app/backend/files
          image: busybox
          imagePullPolicy: Always
          name: chown-files
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
            - mountPath: /usr/src/app/backend/files
              name: spms-media-test
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      terminationGracePeriodSeconds: 180
      tolerations:
        - effect: NoSchedule
          key: kubernetes.azure.com/scalesetpriority
          operator: Equal
          value: spot
      volumes:
        - name: spms-media-test
          persistentVolumeClaim:
            claimName: spms-media-data-test
        - configMap:
            defaultMode: 420
            name: prince2-license-test
          name: prince2-license-test
        - emptyDir:
            medium: Memory
          name: tmpfs-ram-backend
        - emptyDir:
            medium: Memory
          name: tmpfs-ram-frontend
        - configMap:
            defaultMode: 420
            name: prince2-license
          name: prince2-license
status:
  availableReplicas: 2
  conditions:
    - lastTransitionTime: '2025-06-05T12:28:18Z'
      lastUpdateTime: '2025-11-05T02:13:15Z'
      message: >-
        ReplicaSet "spms-deployment-test-7b9fb86457" has successfully
        progressed.
      reason: NewReplicaSetAvailable
      status: 'True'
      type: Progressing
    - lastTransitionTime: '2025-11-06T22:31:54Z'
      lastUpdateTime: '2025-11-06T22:31:54Z'
      message: Deployment has minimum availability.
      reason: MinimumReplicasAvailable
      status: 'True'
      type: Available
  observedGeneration: 753
  readyReplicas: 2
  replicas: 2
  updatedReplicas: 2
